---
title: C 笔记
published: true
date: 2022-01-01 10:00:00 -0000
---
## C 笔记

这是 [《Linux C编程一站式学习》](https://book.douban.com/subject/6025290/)一书的读书笔记。
### 一

程序由一系列指令组成，指令包括：

- 输出
- 输入
- 基本运算
- 测试和分支
- 循环（递归）

编写程序就是这样一个过程：
> 把复杂的任务分解成子任务，把子任务再分解成更简单的任务，层层分解，直到最后简单得可以用以上指令来完成。


- - -

一种平台就是一种体系结构，就是一种指令集，就是一种机器语言。


- - -

计算机只能执行低级语言中的指令（汇编语言的指令要先转成机器码才能执行），高级语言要执行就必须先翻译成低级语言。翻译的方式有两种：1) 编译 2）解释。

1）编译执行的过程：

`source code` --> `complier` --> `executable` -> `loader` --> `输出结果`

把源代码全部翻译成机器指令，再加上一些描述信息，生成一个可执行文件，可执行文件可以被操作系统加载运行。

2） 解释执行的过程：

`source code` --> `interpeter` --> `结果`

解释器读取源代码解释执行，程序运行的结果出现在屏幕上。

虚拟机执行过程：

`source code` --> `complier` --> `byte code` --> `interpeter` --> `结果`

- - -

编程语言是一种形式语言，是专门设计用来表达计算过程的形式语言。

形式语言有严格的语法(Syntax)规则。语法规则是由符号（Token）和结构（structure）的规则所组成。

- 关于 Token 的规则称为词法（Lexical）规则。
- 关于结构的规则称为语法（Grammar）规则。

- - -

程序中的错误叫做 Bug。找到 Bug 并加以纠正的过程叫做调试（Debug）。

程序中的 Bug 分为：

- 编译时错误
- 运行时错误
- 逻辑错误
- 语义错误


### 二

C89 是最早的C语言规范，于 1989 年提出，1990 年首先由 ANSI 推出，后来被采纳位 ISO 国际标准(ISO/IEC9899:1990)，因而有时也称为 C90。

C89 是最广泛采用的C语言标准。

C99 标准在 1999 年推出。

- - -

注释不能嵌套使用，C语言的注释符为 /* 和 */。

单行注释符 // 在 C99 中标准化。

- - -

转义序列是在编译时处理的，而转换说明是在运行时处理的。

```
printf("%d\n", a);

\n --- 转义序列
%d --- 转换说明
```

- - -

变量的类型决定了它所占有的存储空间的大小。

在C语言中用声明（Declaration）来规定变量的名字和类型。

C 语言中的声明有三种：变量声明、函数声明和类型声明。声明分为“是定义（Definition）的声明” 和 “不是定义的声明”。分配存储空间的声明同时也是定义，不分配存储空间的声明不是定义。

- - - 

理解一个概念不是把定义背下来就行了，一定要理解它的外延和内涵，也就是什么情况属于这个概念，什么情况下不属于这个概念，什么情况虽然属于这个概念，但一般推荐的做法（Best practice）是要尽量避免这种情况，这才算是真正理解了。

- - -

定义一个变量，就是分配一块存储空间并给它命名；给一个变量赋值，就是把一个值保存到这块存储空间中。

变量一定要先声明后使用，这样编译才知道如何读写这块存储空间。

变量的定义和赋值可以一步完成，这称为变量的初始化。初始化是一种特殊的声明，而不是一种赋值语句。

变量的最小存储单元是字节（Byte）。

- - -

任何表达式都有值和类型两个基本属性。

等号（=）左边的表达式要求表示一个存储位置，而不是一个值。

表达式所表示的存储位置称为左值（lvalue），允许放在等号（=）左边，如变量就是可以做左值。


## 三

> 在运用逻辑推理时一定要注意，不要把必要条件当充要条件。

函数调用也是一种表达式。

log(1.0) 这个表达式是由操作数 log 和函数调用运算符 () 括号组成。

函数调用运算符是一种后缀运算符，() 括号及其中的参数是操作数 log 的后缀。

操作数 log 是一个函数名，它的类型是一种函数类型 (Function Type)。

- - -

C 标准主要由两部分组成，一部分描述 C 的语法，另一部分描述 C 标准库。

C 标准库定义来一组标准头文件，每个头文件中包含一些相关的函数、变量、类型声明和宏定义。要在一个平台上支持 C 语言，不仅要实现 C 编译器，还要实现 C 标准库，这样的实现才算符号 C 标准。

在 Linux 平台上最广泛使用的 C 函数库是 glibc, 其中包括 C 标准库的实现，也包括系统函数。

- - -

main 函数的返回值是返回给操作系统的，因为 main 函数是被操作系统调用的。

- - -

函数的定义：返回值类型  函数名(参数列表)  函数体。

非定义的函数声明：返回值类型  函数名(参数列表)。

- - -

形参相当于函数中定义的变量，调用函数传递参数的过程相当于定义形参变量并且用实参的值来初始化。

- - -

每次调用函数时，局部变量都表示不同的存储空间。

局部变量在每次函数调用时分配空间，在每次函数返回是释放存储空间。

全局变量定义在函数体之外，在程序运行时分配存储空间，在程序结束时释放存储空间。

局部变量会覆盖全局变量。

局部变量可以用类型相等的任意表达式来初始化，全局变量只能用常量表达式来初始化。

局部变量在定义时不初始化，则初始值是不确定的，所以局部变量在使用之前一定要先赋值。


## 四

语句块中的变量和函数的局部变量作用域不同。

整数除法运算要向 0 取整：5 / 2 = 2。

% 运算符的结果总是与被除数同号。

C 语言规定，else 总是和它上面最近的一个 if 配对。

在 C 语言中通常用 int 型来表示布尔类型: 非 0 表示真，0 表示假。

- - - 

函数返回一个值相当于定一个和返回值类型相同的临时变量并用 return 后面的表达式来初始化。

函数的返回值不是左值，或者说函数调用表达式不能做左值。

- - -

封装就是为了服用。把解决各种小问题的代码封装成函数，在解决第一个大问题时可以用这些函数，在解决第二个大问题时可以复用这些函数。

解决问题的过程是把大问题分解成小问题，小问题在分解更小的问题。这个过程在代码中体现为函数的分层设计：

- 底层函数解决很小的问题。
- 上层函数调用底层函数来解决更大的问题。

- - -

如果定义一个概念需要用到这个概念本身，我们称它的定义是递归的。

自己直接或间接调用自己的函数称为递归函数。

递归函数的正确性可以用数学归纳法来证明，证明：

- 1）Base case 正确
- 2）递推关系正确

写递归函数时一定要记得写 Base Case，否则即使递推关系正确，整个函数也不正确。

递归和循环是等价的，用循环能做的事用递归都能做，反之亦然。

> 递归是计算机的精髓所在，也是编程语言的精髓所在。

- - -

每次调用函数时分配参数和局部变量的存储空间，退出函数是释放它们的存储空间。

函数参数和局部变量的存储空间在栈上分配。

每个函数调用的参数和局部变量的存储空间称为一个栈帧（Stack Frame）。

操作系统为程序的运行预留了一块栈空间，函数调用是就在这个栈空间里分配栈帧，函数返回时就释放栈帧。


## 五、六、七

如果把 ++i 这个表达式看作一个函数调用，除了传入一个参数，返回一个值（等于参数值加 1）之外，还产生一个 Side Effect，就是把变量 i 的值增加了 1。

如果把 i++ 这个表达式看作一个函数调用，传入一个参数返回一个值，返回值就等于参数值（而不是参数值加 1），此外也产生一个 Side Effect，就是把变量 i 的值增加了 1。

- - -

学习一门编程语言是要特别注意三个方面：

1. 这门语言提供了哪些 Primitive，比如基本运算符、表达式和语句, 基本类型。
2. 这门语言提供了哪些组合规则，比如基本类型如何组合成复合类型。
3. 这门语言提供了哪些抽象机制，包括数据抽象和过程抽象。

## 八

数组（Array）也是一种复合数据类型，它由一系列相同类型的元素组成。

和结构体相似，数组元素的存储空间也是相邻的。

定义一个由 4 个 int 型元素组成的数组 count：
```
int count[4];
```
数组下标的表达式不仅可以表示存储单元的值，也可以表示存储单元本身，就是说可以做左值，如：
```
count[0] = 7;
count[1] = count[2] * 2;
++count[2];
```

- - -

在 C 语言中，后缀运算符的优选级最高，单目运算符次之。

- - -

数组不能相互赋值或初始化，也不能用数组类型作为函数的参数或返回值。

- - -

数组类型做右值，自动转换成指向数组首元素的指针。

在函数原型中，如果参数写成数组的形式，则该参数实际上是指针类型。

- - -

define 定义是在预处理阶段除了，而枚举是在编译阶段处理的。

- - -

NULL 表示空指针。

- - -

字符串字面值和数组类型相似，它的每个元素是字符型的。

每个字符串末尾都有一个字符‘\0’做结束符。\0 是 ASCII 码中的 Null 字符。

字符串字面值所代表的存储空间是只读的，不允许修改。
```
"Hello"[0] = 'A'     (x)
```

字符串字面值做右值使用时，自动转换成指向首元素的指针。

- - -

字符数组可以用一个字符串字面值来初始化，如：
```
char str[10] = "Hello";
```
str 的后 4 个元素没有指定，自动初始化为 '\0'，即 Null 字符。

> 写代码最重要的是选择正确的数据结构来组织信息，设计控制流程和算法尚在其次，只要数据结构选择正确，其他代码自然而然就变得容易理解和维护了。

一个数组的元素可以是另一个数组，这样就构成了多维数组。

定义并初始化一个二维数组：

```
int a[3][2] = {1, 2, 3, 4, 5};
```
数组 a 有 3 个元素：a[0]、a[1]、a[2]。每个元素也是一个数组，例如 a[0] 是一个数组，它有两个元素 a[0][0]、a[0][1]，这两个元素的类型是 int，值分别是 1, 2。

*概念模型*

     0    1
------------
0 |  1    2
1 |  3    4
2 |  5    0
------------

从概念模型上看，这个二维数组是三行两列的表格，元素的两个下标分别是行号和列号。

*物理模型*

 a[0][0]  a[0][1]  a[1][0]  a[1][1]  a[2][0]  a[2][1]
-------------------------------------------------------
|   1   |    2    |   3   |   4    |   5    |    o    |
-------------------------------------------------------

从物理模型上看，这 6 个元素在存储器中仍然是连续存储的。

## 九

编码风格

- 用 tab 缩进，tab 最好设成是 8 个空格的长度。
- 函数内的注释要尽可能少用。写注释主要是为了说明代码“能做什么”，比如函数接口定义，而不是为了说明“怎么做”，只要代码写得足够清晰，“怎么做”是一目了然的。
- 复杂的结构体定义比函数更需要注释。
- 标识符命名
  - 变量、函数采用全小写加下划线的方式命名
  - 常量（比如宏定义和枚举常量）采用全大写加下划线的方式命名。
- 每个函数都应该设计得尽可能简单，实现一个函数只是为了做好一件事情。
- 执行函数就是执行一个动作，函数名通常应包含动词。



